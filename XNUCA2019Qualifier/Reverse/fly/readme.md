1.命令还原  
====    
sub_400FD0对输入命令的前4字节进行校验，对输入稍做修改观察输出，可以发现输入最低字节不变时，输出最低字节也不变，输入低2字节不变时，输出低2字节也不变，依次类推...可以从低字节到高字节逐字节爆破，最后发现所有命令前4字节可以为"set ","radr","fire","land","run "。或者如果能看出sub_400F20用于计算((a1+1)|(a2+1)) - (a1|a2)的结果，则循环0x17f7f次后得到的累计结果为0xdeadbeaf+((c1+0x17f7f)|(c2+0x17f7f)) - (c1|c2)，其中:    
c1 = \*(_DWORD \*)arg1 & ~\*(_DWORD \*)arg2;   
c2 = \*(_DWORD \*)arg2 & ~\*(_DWORD \*)arg1。   
而校验条件为(c1+0x17f7f)|(c2+0x17f7f)==0xdeadbeaf+((c1+0x17f7f)|(c2+0x17f7f)) - (c1|c2),即   
\*(_DWORD \*)arg2 ^ \*(_DWORD \*)==0xdeadbeaf，直接将第2个参数的4字节异或0xdeadbeaf即可。  

2.程序流程    
====
* radr能显示后面4张地图；  
* r1,r2,r3,r4这4个参数不同的组合控制玩家前进的方向，通过"set rn v"命令来修改其值；  
* runx将使得玩家向当前方向走x步，有一个初始值为30的能量，每走1步能量减1，减到0就失败；     
* land用于走到最下面一行，如果land走到的地点为'E'，能量就变为30，如果走到的是'B'，则设为一个很大的值，land时需要根据打印的密钥对SPN加密的密文解密才能成功执行；   
* 地图后半部分有单方向往返移动的敌人，fire命令可以消灭下一张地图与玩家同一位置的敌人，执行fire的时候敌人会继续移动，所以其实可以一直输fire就能等敌人走过来被消灭，输入fire命令会打印srand(time(0))后rand()结果的md5值，只要爆破一下时间种子就能得到结果，使用fire会消耗30能量，所以要先走到'B'才能用。   
* 最后走到'F'处，如果消灭了30个敌人，就能得到flag。   

3.题解  
====
观察一下地图可以发现每隔1张地图就有一个地图只有一个位置可以走，可以通过这个来得到当前地图要走到的终点，可以通过BFS来获取走的路径，其实几个check都比较简单，耐心慢慢逆还是可以做的。解题脚本见wp.py



